		CPU 68020
		SUPMODE ON
		PADDING OFF
		ORG $000000

RESET_SP:	
		dc.l	$0041fffc
RESET_PC:	
		dc.l	entry

		dc.l [($60-*)/4]nop_rte
		ORG $60
SPURIOUS_INT:	
		dc.l	nop_rte
		dc.l 	nop_rte
		dc.l	vblank
		dc.l	vblank_2
		dc.l	nop_rte
		dc.l	timer
		dc.l	nop_rte
AVEC_7:	
		dc.l	nop_rte

		dc.l	$0

;;	dc.l [($400-*)/4]nop_rte

		ORG	$400

font_def:
		dc.b [32]$00, [2]$11, $00, $10, $00, $01, $00, $10, $01
		dc.b $11, $00, $10, $00, $01, $00, $10, $01, $11, $00, $10
		dc.b $00, $01, $00, $10, $01, $11, $00, $10, $00, $01, $00
		dc.b $10, [320]$00, [4]$22, $00, $02, [3]$00, $02, [3]$00, $02
		dc.b [3]$00, $02, [3]$00, $02, [3]$00, $02, [3]$00, $02, [2]$00
		dc.b [4]$22, [2]$00, $20, [3]$00, $20, [3]$00, $20, [3]$00, $20
		dc.b [3]$00, $20, [3]$00, $20, [3]$00, $20, [2]$00, $02, [3]$00
		dc.b $02, [3]$00, $02, [3]$00, $02, [3]$00, $02, [3]$00, $02
		dc.b [3]$00, $02, [2]$00, [4]$22, [2]$00, $20, [3]$00, $20
		dc.b [3]$00, $20, [3]$00, $20, [3]$00, $20, [3]$00, $20, [3]$00
		dc.b $20, $00, [36]$22, [420]$00, $20, [2]$00, $07, $22, [2]$00
		dc.b $07, $22, $20, [3]$22, $70, [2]$77, $27, [2]$00, $07, $70
		dc.b [2]$00, $07, [4]$00, $22, $20, $00, $07, $77, $20, $00
		dc.b $07, $72, $20, $72, $22, $77, [3]$27, $22, [3]$27, $77
		dc.b $70, [2]$27, [2]$00, $72, $22, [2]$00, [2]$77, [32]$00, $22
		dc.b [2]$00, $72, $22, [2]$00, $72, $22, [2]$00, $72, $22
		dc.b [2]$00, $77, $22, [2]$00, $07, $77, [2]$00, $07, $22
		dc.b [2]$00, $07, $77, [2]$00, $07, $72, $20, $07, $22, $72
		dc.b $20, $07, $22, $77, $20, $07, $72, $07, $70, $00, $77
		dc.b [16]$00, $72, $20, $07, $22, $72, $20, $07, [3]$22, $72
		dc.b $22, $72, $27, $77, [3]$22, $72, $22, $72, $27, $77, $22
		dc.b $72, $20, $07, $22, $77, $70, $07, $77, $20, [2]$00, $07
		dc.b $22, $20, $07, $22, $27, $22, $07, $77, $22, $27, $07
		dc.b $22, $27, $70, $72, $27, $22, $20, $77, $22, $27, $70
		dc.b $07, $77, $70, [2]$00, [2]$07, $20, $72, $00, [2]$72, $77
		dc.b $20, $77, $27, $07, $72, $27, $70, $00, $77, $72, $00
		dc.b $07, $27, $77, $20, [2]$72, $07, $72, $77, $27, $00, $77
		dc.b $07, $70, $22, [2]$00, $07, $77, $20, $00, [2]$72, $20
		dc.b $00, $72, $22, $20, $00, $77, $27, [3]$72, $70, $72, $77
		dc.b [2]$22, $27, [2]$72, $77, $70, [2]$77, $72, $20, [2]$00
		dc.b $72, $20, [2]$00, $72, $70, [2]$00, $77, $20, [2]$00, $07
		dc.b $70, [14]$00, $20, [2]$00, $72, $22, [2]$00, $77, $72, $20
		dc.b $00, $07, $72, $20, [2]$00, $72, $20, [2]$00, $22, $70
		dc.b $00, $07, $27, [2]$00, $72, $70, [2]$00, $77, $22, [2]$00
		dc.b $07, $27, [2]$00, $72, $70, $00, $07, $22, [2]$00, $07
		dc.b $22, [2]$00, $07, $22, $20, $00, $07, $72, $22, [2]$00
		dc.b [2]$77, [2]$00, $07, [4]$00, $07, $20, $07, $20, $72, $70
		dc.b $07, $72, $27, [2]$00, $77, $72, [2]$00, $72, $77, $20
		dc.b $07, $27, $07, $70, $07, $70, [8]$00, $20, [2]$00, $07
		dc.b $20, [2]$00, $07, $22, $20, $07, $22, $27, $70, $07, $77
		dc.b $20, [2]$00, $07, $70, [2]$00, $07, [20]$00, $22, [2]$00
		dc.b $07, $22, [2]$00, $07, $72, $20, $00, $07, $77, $70
		dc.b [14]$00, $22, $20, $07, $22, $77, $70, $07, $77, [32]$00
		dc.b $22, [2]$00, $07, $22, [2]$00, $07, $77, [2]$00, $07
		dc.b [6]$00, $07, $20, [2]$00, $07, $72, $20, [2]$00, $77, $72
		dc.b [2]$00, $07, $77, $20, [2]$00, $07, $70, [6]$00, $22
		dc.b [2]$00, $72, $77, $20, $07, $22, $07, $22, $72, $27, $07
		dc.b $22, $72, $20, $07, $22, $72, $20, $02, $27, $77, $20
		dc.b $22, $70, $07, $72, $77, [2]$00, $77, $20, [2]$00, $72
		dc.b $22, [2]$00, $72, $27, [2]$00, $72, $20, [2]$00, $72, $20
		dc.b [2]$00, $72, $20, [2]$00, $72, $22, $20, $72, $22, $77
		dc.b $70, [2]$77, $22, $20, $07, $22, $77, $22, $72, $27, $07
		dc.b $77, $72, [2]$22, $00, $77, [2]$22, $20, $07, [2]$72, $22
		dc.b $00, $77, [2]$22, $72, $22, [4]$77, $22, $20, $72, $22
		dc.b $77, $70, $77, $22, $20, $00, $07, $72, $22, $00, $07
		dc.b $22, $77, $00, $72, $27, $07, $22, $72, $20, $22, $27
		dc.b $77, $22, $77, $70, $07, $77, $20, $00, $07, [2]$22, $00
		dc.b $07, $22, $72, $20, $07, $22, $77, $22, $07, [3]$22, $72
		dc.b $22, [3]$77, $22, [2]$00, $07, $22, [2]$00, $07, $77
		dc.b [2]$22, $07, $22, $77, $22, $07, $77, [2]$22, $07, $22
		dc.b [2]$77, $72, $27, [2]$00, $72, $20, $07, $22, $72, $20
		dc.b $22, $27, $77, $22, $77, $70, $07, $77, $22, $00, $07
		dc.b $22, $72, $20, $07, [2]$77, $22, [2]$00, [2]$22, $07, $22
		dc.b $77, $22, $72, $27, $07, $22, $72, $20, $22, $27, $77
		dc.b $22, $77, $70, $07, $77, [2]$22, $72, $22, $77, $22, $72
		dc.b $27, $07, [2]$77, $22, $20, $00, $07, $72, $22, [2]$00
		dc.b $77, $22, [2]$00, $07, $22, [2]$00, $07, $77, [2]$00, $07
		dc.b $22, $20, $00, $72, $77, $22, $07, $27, $02, $22, $07
		dc.b $20, $22, $27, $07, $72, $27, [2]$72, $22, $70, [2]$72
		dc.b $27, $22, $27, $77, $22, $77, $70, $07, $77, $22, $20
		dc.b $07, $22, $77, $22, $72, $27, $07, $22, $72, $20, $22
		dc.b $27, $72, $22, $77, $70, $72, $27, [2]$00, $77, [2]$22
		dc.b $20, $07, $72, $77, $70, $00, $77, [4]$00, $22, [2]$00
		dc.b $07, $22, [2]$00, $07, $77, [2]$00, $07, $22, [2]$00, $07
		dc.b $22, [2]$00, $07, $77, [2]$00, $07, [8]$00, $22, [2]$00
		dc.b $07, $22, [2]$00, $07, $77, [2]$00, $07, $22, [2]$00, $07
		dc.b $22, [2]$00, $07, $72, $20, $00, $07, $77, $70, [4]$00
		dc.b $07, $22, $20, $00, $07, $72, $22, [2]$00, $77, $72, $20
		dc.b $00, $07, $22, $70, $00, $07, $27, [2]$00, $72, $70, $00
		dc.b $07, $22, [2]$00, $07, $77, [8]$00, $22, $20, $07, $22
		dc.b $77, $70, $07, $77, $22, $20, $07, $22, $77, $70, $07
		dc.b $77, [8]$00, $72, $20, [2]$00, $22, $70, $00, $07, $27
		dc.b [2]$00, $72, $70, $00, $07, $22, $20, $00, $07, $72, $22
		dc.b [2]$00, $77, $72, $20, $00, $07, $77, $70, [2]$00, $22
		dc.b $20, $07, [3]$22, $72, $22, $77, $22, $72, $27, $07
		dc.b [2]$77, [2]$22, $00, $07, $72, $77, [2]$00, $77, $22
		dc.b [2]$00, $72, $77, [2]$00, $77, $22, [2]$00, $72, $77, $20
		dc.b $07, $27, $20, [6]$72, $07, [3]$72, $00, $27, [3]$72, $77
		dc.b $27, $77, $27, $22, $70, $07, $72, $22, [2]$00, [2]$72
		dc.b $20, $07, $22, $07, $22, $72, $27, $07, $22, $72, $20
		dc.b [2]$22, $72, $22, $77, $22, $72, $27, $07, $22, $72, $20
		dc.b $07, [2]$77, $70, [2]$22, $07, $22, $77, $22, $72, $27
		dc.b $07, $22, $72, $20, [2]$22, $77, $22, $77, $22, $72, $27
		dc.b $07, $22, $72, $20, [2]$22, $77, $22, [2]$77, $07, $77
		dc.b $22, $00, $07, $22, $72, $20, $72, $27, $77, $22, $77
		dc.b $70, $07, $22, [2]$00, $07, $22, [2]$00, $72, $27, $72
		dc.b $20, $22, $70, $77, $22, $77, $00, $07, $77, [2]$22, $00
		dc.b $72, $77, $22, $07, $22, $07, $22, $72, $20, $07, $22
		dc.b $72, $20, $07, $22, $72, $20, $07, $22, $77, [3]$22, $07
		dc.b $72, [2]$77, $00, $77, [2]$22, $72, $22, $77, $22, [2]$77
		dc.b $07, $22, [2]$00, [2]$22, $07, $22, $77, $22, $07, $77
		dc.b $07, $22, [2]$00, [2]$22, $72, $22, [4]$77, [2]$22, $72
		dc.b $22, $77, $22, [2]$77, $07, $22, [2]$00, [2]$22, $07, $22
		dc.b $77, $22, $07, $77, $07, $22, [2]$00, $07, $22, [2]$00
		dc.b $07, $77, [2]$00, $22, $00, $72, $22, $72, $20, [3]$77
		dc.b $22, [2]$00, $07, $22, $72, $22, $07, $22, $72, $27, $72
		dc.b $27, $72, $20, $22, $70, $72, $22, $77, $00, [2]$77, $07
		dc.b $22, $72, $20, $07, $22, $72, $20, $07, $22, $72, $20
		dc.b [2]$22, $72, $22, $77, $22, $72, $27, $07, $22, $72, $20
		dc.b $07, $22, $72, $20, $07, [2]$77, $70, $22, $20, $72, $22
		dc.b $27, $70, $77, $72, $20, [2]$00, $72, $20, [2]$00, $72
		dc.b $20, [2]$00, $72, $20, [2]$00, $72, $22, $20, $72, $22
		dc.b $77, $70, [2]$77, [2]$00, $72, $20, [2]$00, $72, $20
		dc.b [2]$00, $72, $20, [2]$00, $72, $20, [2]$00, $72, $20, $07
		dc.b $22, $72, $20, $22, $27, $77, $22, $77, $70, $07, $77
		dc.b $07, $22, $72, $20, $07, $22, $77, $22, $27, $22, $07
		dc.b $72, [2]$22, $00, $77, [2]$22, $00, $72, $27, $22, $07
		dc.b $22, $77, $22, $72, $22, $07, [3]$77, $07, $22, [2]$00
		dc.b $07, $22, [2]$00, $07, $22, [2]$00, $07, $22, [2]$00, $07
		dc.b $22, [2]$00, $07, $22, [2]$00, [2]$22, $72, $22, [4]$77
		dc.b $07, $22, $72, $20, $72, $22, $72, [3]$22, $72, [3]$22
		dc.b $72, $22, $27, $22, $72, $27, $77, $22, $72, $27, $07
		dc.b $22, $72, $20, $07, [2]$77, $70, $07, $22, $72, $20, $72
		dc.b $22, $72, $20, [2]$22, $72, $27, [2]$22, $72, $22, $27
		dc.b $22, $72, $22, $77, $22, $72, $22, $07, $22, $72, $27
		dc.b $07, [2]$77, $70, $22, $20, $07, $22, $77, $22, $72, $27
		dc.b $07, $22, $72, $20, $07, $22, $72, $20, $07, $22, $72
		dc.b $20, $07, $22, $72, $20, $22, $27, $77, $22, $77, $70
		dc.b $07, $77, [2]$22, $07, $22, $77, $22, $72, $27, $07, $22
		dc.b $72, $20, $07, $22, $72, $20, [2]$22, $77, $22, $77, $22
		dc.b $07, $77, $07, $22, [2]$00, $07, $77, [2]$00, $22, $20
		dc.b $07, $22, $77, $22, $72, $27, $07, $22, $72, $20, $07
		dc.b $22, $72, $20, $27, $22, $72, $22, $77, $22, $77, [2]$22
		dc.b $27, [2]$72, $77, $70, [2]$77, [2]$22, $07, $22, $77, $22
		dc.b $72, $27, $07, $22, $72, $20, $07, $22, $72, [3]$22, $77
		dc.b $72, $27, $22, $07, $22, $77, $22, $72, $22, $07, [3]$77
		dc.b $22, $20, $00, $72, $77, $22, $07, $22, $07, $22, $07
		dc.b $77, $22, $27, $07, $22, $77, $70, $72, $27, $00, $22
		dc.b $72, $20, $22, $27, $77, $22, $77, $70, $07, $77, $22
		dc.b $20, $72, $22, $27, $70, $77, $72, $20, [2]$00, $72, $20
		dc.b [2]$00, $72, $20, [2]$00, $72, $20, [2]$00, $72, $20
		dc.b [2]$00, $72, $70, [2]$00, $77, $07, $22, $72, $20, $07
		dc.b $22, $72, $20, $07, $22, $72, $20, $07, $22, $72, $20
		dc.b $07, $22, $72, $20, $07, $22, $72, $20, $22, $27, $77
		dc.b $22, $77, $70, $07, $77, $07, $22, $72, $20, $07, $22
		dc.b $72, $20, $07, $22, $72, $20, $72, $22, $72, [2]$22, $27
		dc.b $77, [2]$22, $70, $07, $72, $27, [2]$00, $77, $70, [2]$00
		dc.b [2]$07, $22, $72, $20, $07, $22, $72, $20, $27, $22, $72
		dc.b $27, [2]$22, $72, [3]$22, $72, $22, $72, $22, $72, $22
		dc.b $77, $22, $72, $27, $07, [2]$77, $70, $07, $22, $72, $20
		dc.b $72, $22, $72, [2]$22, $27, $77, [2]$22, $70, $07, $72
		dc.b $22, $20, $07, $22, $72, $22, $72, $22, $77, $22, $72
		dc.b $27, $07, [2]$77, $70, $72, $20, $72, $20, $72, $20, $72
		dc.b $20, $72, $20, $72, $20, $22, $70, $77, $22, $27, $00
		dc.b $07, $72, $20, [2]$00, $72, $20, [2]$00, $72, $70, [2]$00
		dc.b $77, [2]$22, $72, $22, [2]$77, $72, $22, $20, $00, $77
		dc.b [2]$22, $00, $07, $72, $22, $20, $00, $77, $72, $22, $00
		dc.b $07, [2]$22, $72, $22, [4]$77, $22, $00, $07, [2]$22, $00
		dc.b $07, $77, $22, [2]$00, $07, $22, [2]$00, $07, $22, [2]$00
		dc.b $07, $22, [2]$00, $07, $22, $00, $07, $22, $77, $00, $07
		dc.b $77, [6]$00, $07, $20, [2]$00, $07, $72, $20, [2]$00, $77
		dc.b $72, [2]$00, $07, $77, $20, [2]$00, $07, $70, [6]$00, $22
		dc.b [2]$20, $72, $27, $70, $20, $72, $20, $00, $20, $72, $20
		dc.b $00, $20, $72, $20, $00, $20, $72, $20, $00, $20, $72
		dc.b $22, [2]$20, $72, $77, $70, $20, $77, [2]$22, $72, $22
		dc.b [4]$77, $00, $07, [3]$00, $07, [3]$00, $07, [3]$00, $07
		dc.b [3]$00, $07, [3]$00, $07, [2]$00, $72, $20, $07, $22, $72
		dc.b $20, $07, $22, $72, $70, $07, $27, $77, $00, $07, $70
		dc.b [16]$00


;;; print string on stack
print_str:
strptr = $8
textram_loc = $c
color = $10
		link.w	A6,#$0
		movem.l	A1/A0/D7, -(SP)
		movea.l	(strptr,A6),A0
		movea.l	(textram_loc,A6),A1
		move.w	(color,A6),D7
		add.w	D7,D7
LAB_000057b8:
		move.b	(A0)+,D0
		beq.b	LAB_000057c2
		move.b	D7,(A1)+
		move.b	D0,(A1)+
		bra.b	LAB_000057b8
LAB_000057c2:
		move.l	A1,D0
		movem.l	(SP)+, D7/A0/A1
		unlk	A6
		rts	

text_coord	FUNCTION x,y,$61c000 + 2*(y*$40 + x)
PRINT	MACRO charptr,x,y,color
		move.w 	color,-(SP)
		pea		(text_coord(x,y)).l
		pea		(charptr)
		nop
		jsr		(print_str)
		lea		($a,SP),SP
		ENDM

lr_colscroll	FUNCTION pf,$624000 + $200*(pf)
lr_clipdef	FUNCTION cp,$625000 + $200*(cp)

lr_sp_prio	= $627600
lr_scale	FUNCTION pf,$628000 + $200*(pf)
lr_pal_add	FUNCTION pf,$629000 + $200*(pf)
lr_rowscroll	FUNCTION pf,$62a000 + $200*(pf)
lr_pf_prio	FUNCTION pf,$62b000 + $200*(pf)


FILL_W	MACRO dest,len,val
		lea	dest,A0
		move.w	len,D0
.fill_loop:
		move.w	val,(A0)+
		dbf	D0,.fill_loop
		ENDM

FILL_L	MACRO dest,len,val
		lea	dest,A0
		move.w	len,D0
.fill_loop:
		move.l	val,(A0)+
		dbf	D0,.fill_loop
		ENDM

;;; fill dest1 with val1 and dest2 with val2 for len [long]s
FILL_L2	MACRO dest1,dest2,len,val1,val2
		lea	dest1,A0
		lea	dest2,A1
		move.w	len,D0
.fill_loop:
		move.l	val1,(A0)+
		move.l	val2,(A0)+
		dbf	D0,.fill_loop
		ENDM



s_WAIT_A_MOMENT:
		dc.b	"WAIT FOR EVER\0\0\0"

nop_rte:
		rte


reset_lineram_:
		movem.l	A3/A2/A1/A0/D3/D2/D1/D0, -(SP)
		lea	(lineram_settings_table1,PC),A0
		lea	($624000).l,A1
		moveq	#$7,D3
		moveq	#$0,D0
		tst.b	(-$7ec2,A5)
		bne.b	LAB_00005cf2
		moveq	#$30,D0
LAB_00005cf2:
		adda.l	D0,A1
		move.w	D0,(-$7ec0,A5)
LAB_00005cf8:
		move.w	(A0)+,D0
		bsr.b	memset_231
		move.w	(A0)+,D0
		bsr.b	memset_231
		move.w	(A0)+,D0
		bsr.b	memset_231
		move.w	(A0)+,D0
		bsr.b	memset_231
		lea	($800,A1),A1
		dbf	D3,LAB_00005cf8
		lea	($620000).l,A1
		moveq	#$7,D3
		move.l	#$624000,D0
		lsr.l	#$8,D0
		lsr.l	#$4,D0
		lsl.l	#$8,D0
		lsl.l	#$2,D0
		addi.w	#$f,D0
		andi.w	#$7fff,D0
LAB_00005d2e:
		move.w	#$ff,D1
LAB_00005d32:
		move.w	D0,(A1)+
		dbf	D1,LAB_00005d32
		ror.l	#$4,D2
		addi.w	#$400,D0
		dbf	D3,LAB_00005d2e
		tst.w	(-$7ec2,A5)
		bne.w	LAB_00005d56
		move.w	#$800,($626000).l
		bra.w	LAB_00005d5e
LAB_00005d56:
		move.w	#$800,($6261fe).l
LAB_00005d5e:
		movem.l	(SP)+, D0/D1/D2/D3/A0/A1/A2/A3
		rts	
memset_231:
		move.w	#$e7,D1
LAB_00005d68:
		move.w	D0,(A1)+
		dbf	D1,LAB_00005d68
		lea	($30,A1),A1
		rts
lineram_settings_table1:
		dc.w $0000,$0000,$0000,$0000
		dc.w $0000,$0000,$0000,$0000
		dc.w $00fb,$bbbb,$7000,$0000
		dc.w $0000,$300f,$0300,$aa88
		dc.w $0080,$0080,$0080,$0080
		dc.w $0000,$0000,$0000,$0000
		dc.w $0000,$0000,$0000,$0000
		dc.w $3002,$3009,$300c,$300d

load_game_font:
		lea	(font_def).l,A0
		move.w	#$2ff,D0
		lea	($61e000).l,A1
LAB_00005b86:
		move.l	(A0)+,D1
		;; swap...
		swap	D1
		move.l	D1,(A1)+
		dbf	D0,LAB_00005b86
		move.w	#$7,D0
		lea	($61f200).l,A1
LAB_00005b9a:
		clr.l	(A1)+
		dbf	D0,LAB_00005b9a
		rts



playfield_scroll_params_reset:
PF_SCROLL_REGS = $4000d8
ram_flipscreen = -$7ec2	
		movem.l	A0, -(SP)
		lea	(PF_SCROLL_REGS).l,A0
		tst.w	(ram_flipscreen,A5)
		bne.w	.flip_scroll_defaults
		move.w	#-$a00,(A0)+
		move.w	#-$80,(A0)+
		move.w	#-$900,(A0)+
		move.w	#-$c00,(A0)+
		move.w	#-$800,(A0)+
		move.w	#-$c00,(A0)+
		move.w	#-$700,(A0)+
		move.w	#-$80,(A0)+
		move.w	#$29,(A0)+
		move.w	#$18,(A0)+
		bra.w	.end
.flip_scroll_defaults:
		move.w	#-$5a00,(A0)+
		move.w	#-$7480,(A0)+
		move.w	#-$5900,(A0)+
		move.w	#-$8000,(A0)+
		move.w	#-$5800,(A0)+
		move.w	#-$8000,(A0)+
		move.w	#-$5700,(A0)+
		move.w	#-$7480,(A0)+
		move.w	#$9e,(A0)+
		move.w	#$100,(A0)+
.end:
		movem.l	(SP)+, A0
		rts	


PF_0_TILES = $610000
PF_1_TILES = $612000
PF_2_TILES = $614000
PF_3_TILES = $616000
PVT_TILES = $61c000
reset_pivot:
		movem.l	A0/D1/D0, -(SP)
		move.l	#$2900290,D1
		FILL_L (PVT_TILES).l, #$7ff, D1
		moveq	#$0,D1
		move.w	D1,(-$7ef2,A5)
		move.w	D1,(-$7eee,A5)
		move.l	D1,(-$7eca,A5)
		move.w	D1,(-$7ec6,A5)
		movem.l	(SP)+, D0/D1/A0
		rts	
reset_tilemap_0:
		movem.l	A1/A0/D1/D0, -(SP)
		moveq	#$0,D1
		FILL_L (PF_0_TILES).l, #$7ff, D1
		FILL_L (lr_rowscroll(0)).l, #$ff, D1
		move.l	D1,(-$7f12,A5)
		move.l	D1,(-$7f0e,A5)
		move.l	D1,(-$7eea,A5)
		move.l	D1,(-$7ee6,A5)
		movem.l	(SP)+, D0/D1/A0/A1
		rts
reset_tilemap_1:
		movem.l	A1/A0/D1/D0, -(SP)
		moveq	#$0,D1
		FILL_L (PF_1_TILES).l, #$7ff, D1
		FILL_L (lr_rowscroll(1)).l, #$ff, D1
		move.l	D1,(-$7f0a,A5)
		move.l	D1,(-$7f06,A5)
		move.l	D1,(-$7ee2,A5)
		move.l	D1,(-$7ede,A5)
		movem.l	(SP)+, D0/D1/A0/A1
		rts
reset_tilemap_2:
		movem.l	A1/A0/D2/D1/D0, -(SP)
		moveq	#$0,D1
		FILL_L (PF_2_TILES).l, #$7ff, D1
		FILL_L (lr_rowscroll(2)).l, #$ff, D1
		move.w	#$80,D1
		moveq	#$0,D2
		FILL_L2	(lr_scale(2)).l, (lr_colscroll(2)).l, #$ff, D1, D2
		move.l	D2,(-$7f02,A5)
		move.l	D2,(-$7efe,A5)
		move.l	D2,(-$7eda,A5)
		move.l	D2,(-$7ed6,A5)
		movem.l	(SP)+, D0/D1/D2/A0/A1
		rts
reset_tilemap_3:
		movem.l	A1/A0/D2/D1/D0, -(SP)
		moveq	#$0,D1
		FILL_L (PF_3_TILES).l, #$7ff, D1
		FILL_L (lr_rowscroll(3)).l, #$ff, D1
		move.w	#$80,D1
		moveq	#$0,D2
		FILL_L2	(lr_scale(3)).l, (lr_colscroll(3)).l, #$ff, D1, D2
		move.l	D2,(-$7efa,A5)
		move.l	D2,(-$7ef6,A5)
		move.l	D2,(-$7ed2,A5)
		move.l	D2,(-$7ece,A5)
		movem.l	(SP)+, D0/D1/D2/A0/A1
		rts

reset_text_tilemaps_lineram:
		jsr	reset_pivot
		jsr reset_tilemap_0
		jsr reset_tilemap_1
		jsr reset_tilemap_2
		jsr reset_tilemap_3
		jsr reset_lineram_
		rts

SPRITERAM_TOP = $600000
SPRITERAM_BODY = $600010
SPRITE	MACRO dest,tile,zoom,xpos,ypos,blockctrl,palette
		move.w tile, (dest)
		move.w zoom, ($2,dest)
		move.w xpos, ($4,dest)
		move.w ypos, ($6,dest)
		move.w blockctrl, ($8,dest)
		move.w palette, ($A,dest)
		ENDM

reset_spriteram:
		movem.l	A1/A0/D0, -(SP)
		;; bsr.w	clear_spriteram_etc
		lea	($600000).l,A0
		lea	($600010).l,A1
		SPRITE A0, #0, #0, #$3000, #$8000, #0, #0, #0, #0
		SPRITE A1, #0, #0, #$3000, #$8000, #0, #0, #0, #0
		lea	($608000).l,A0
		lea	($608010).l,A1
		SPRITE A0, #0, #0, #$3000, #$8000, $0, $0, $0, #0
		SPRITE A1, #0, #0, #$3000, #$8000, #0, #0, #0, #0
		movem.l	(SP)+, D0/A0/A1
		rts	

RAM_BASE = $408000
entry:
		lea (RAM_BASE).l, A5
		nop

		jsr	load_game_font
		jsr	playfield_scroll_params_reset
		jsr	reset_text_tilemaps_lineram
		jsr	reset_spriteram
	;; jsr	load_system_palettes
	;; jsr	clear_shared_ram_
	;; jsr	Z_reset_3FF_3FE_E0_1_FF
	;; jsr	coin_exchange_rate_init_

		PRINT	s_WAIT_A_MOMENT,14,15,#$0
.loop
		jmp .loop


FIO_0 = $4a0000
vblank:
		moveq	#$0, D0
		move.b	D0, (FIO_0).l
		rte
vblank_2:
		rte
timer:
		rte

